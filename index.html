<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tamagotchi - Virtual Pet Game</title>
    <meta name="description" content="Raise your own cute digital pet! Free online Tamagotchi game">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DotGothic16&display=swap" rel="stylesheet">
    
    <!-- Google AdSense -->
    <!-- <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-YOUR_PUBLISHER_ID" crossorigin="anonymous"></script> -->
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --screen-bg: #c4cfa1;
            --screen-pixel: #414141;
            --text-dark: #333;
        }

        body {
            font-family: 'DotGothic16', monospace;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .ad-banner {
            width: 100%;
            max-width: 728px;
            height: 90px;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.5);
            font-size: 14px;
            margin-bottom: 20px;
            border-radius: 8px;
        }

        .game-title {
            font-size: 2rem;
            color: white;
            text-shadow: 3px 3px 0 rgba(0,0,0,0.3);
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        /* Ïª§Î≤Ñ ÏÑ†ÌÉù */
        .cover-selector {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .cover-btn {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            border: 3px solid rgba(255,255,255,0.5);
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
        }

        .cover-btn:hover {
            transform: scale(1.1);
            border-color: white;
        }

        .cover-btn.active {
            border-color: white;
            box-shadow: 0 0 15px rgba(255,255,255,0.5);
        }

        .cover-btn.pink { background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%); }
        .cover-btn.blue { background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%); }
        .cover-btn.purple { background: linear-gradient(135deg, #a18cd1 0%, #fbc2eb 100%); }
        .cover-btn.mint { background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%); }
        .cover-btn.orange { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }
        .cover-btn.glitter { 
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        .cover-btn.glitter::after {
            content: '‚ú®';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 16px;
        }

        /* Îã¨Í±Ä Î™®Ïñë Í∏∞Í∏∞ */
        .device {
            position: relative;
            width: 320px;
            height: 400px;
            filter: drop-shadow(0 20px 40px rgba(0,0,0,0.4));
        }

        .device-body {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #ff9a9e 100%);
            border-radius: 50% 50% 47% 47% / 60% 60% 40% 40%;
            box-shadow: 
                inset 0 -20px 40px rgba(0,0,0,0.1),
                inset 0 10px 30px rgba(255,255,255,0.4);
            transition: background 0.5s ease;
        }

        .device-body.pink {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 50%, #ff9a9e 100%);
        }
        .device-body.blue {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 50%, #a1c4fd 100%);
        }
        .device-body.purple {
            background: linear-gradient(135deg, #a18cd1 0%, #ddd6f3 50%, #a18cd1 100%);
        }
        .device-body.mint {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 50%, #84fab0 100%);
        }
        .device-body.orange {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 50%, #fa709a 100%);
        }
        .device-body.glitter {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 50%, #f093fb 100%);
            position: relative;
        }
        .device-body.glitter::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: 
                radial-gradient(2px 2px at 20px 30px, white, transparent),
                radial-gradient(2px 2px at 40px 70px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 90px 40px, white, transparent),
                radial-gradient(2px 2px at 130px 80px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 160px 120px, white, transparent),
                radial-gradient(2px 2px at 200px 60px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 60px 140px, white, transparent),
                radial-gradient(2px 2px at 240px 100px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 80px 200px, white, transparent),
                radial-gradient(2px 2px at 180px 180px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 260px 200px, white, transparent),
                radial-gradient(2px 2px at 100px 280px, rgba(255,255,255,0.8), transparent),
                radial-gradient(2px 2px at 220px 260px, white, transparent),
                radial-gradient(2px 2px at 280px 300px, rgba(255,255,255,0.8), transparent);
            border-radius: inherit;
            animation: sparkle 2s ease-in-out infinite;
        }

        @keyframes sparkle {
            0%, 100% { opacity: 0.7; }
            50% { opacity: 1; }
        }

        /* Ï≤¥Ïù∏ Í≥†Î¶¨ */
        .chain-loop {
            position: absolute;
            top: -15px;
            left: 50%;
            transform: translateX(-50%);
            width: 40px;
            height: 25px;
            border: 6px solid #888;
            border-bottom: none;
            border-radius: 20px 20px 0 0;
            background: transparent;
        }

        /* ÌôîÎ©¥ ÌîÑÎ†àÏûÑ */
        .screen-frame {
            position: absolute;
            top: 70px;
            left: 50%;
            transform: translateX(-50%);
            width: 180px;
            height: 160px;
            background: white;
            border-radius: 15px;
            padding: 8px;
            box-shadow: inset 0 2px 10px rgba(0,0,0,0.2);
        }

        /* LCD ÌôîÎ©¥ */
        .screen {
            width: 100%;
            height: 100%;
            background: var(--screen-bg);
            border-radius: 8px;
            position: relative;
            overflow: hidden;
            image-rendering: pixelated;
        }

        /* Ïä§Ï∫îÎùºÏù∏ Ìö®Í≥º */
        .screen::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: repeating-linear-gradient(
                0deg,
                rgba(0,0,0,0.03) 0px,
                rgba(0,0,0,0.03) 1px,
                transparent 1px,
                transparent 2px
            );
            pointer-events: none;
        }

        /* ÌôîÎ©¥ ÏÉÅÎã® ÏïÑÏù¥ÏΩòÎì§ */
        .screen-icons {
            position: absolute;
            top: 4px;
            left: 4px;
            right: 4px;
            display: flex;
            justify-content: space-between;
            font-size: 10px;
        }

        .screen-icon {
            width: 16px;
            height: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.4;
        }

        .screen-icon.active {
            opacity: 1;
        }

        /* ÌîΩÏÖÄ Ï∫êÎ¶≠ÌÑ∞ ÏòÅÏó≠ */
        .pixel-pet-container {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* ÌîΩÏÖÄ ÏïÑÌä∏ Ï∫êÎ¶≠ÌÑ∞ - CSS Grid Í∏∞Î∞ò */
        .pixel-pet {
            display: grid;
            grid-template-columns: repeat(16, 6px);
            grid-template-rows: repeat(16, 6px);
            gap: 0;
            animation: bounce 1s ease-in-out infinite;
        }

        .pixel-pet.sleeping {
            animation: sleep-bounce 2s ease-in-out infinite;
        }

        .pixel-pet.eating {
            animation: eat 0.3s ease-in-out infinite;
        }

        .pixel-pet.playing {
            animation: wiggle 0.4s ease-in-out infinite;
        }

        @keyframes bounce {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-4px); }
        }

        @keyframes sleep-bounce {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.95); }
        }

        @keyframes eat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes wiggle {
            0%, 100% { transform: rotate(-3deg); }
            50% { transform: rotate(3deg); }
        }

        .pixel {
            width: 6px;
            height: 6px;
            background: transparent;
        }

        .pixel.on {
            background: var(--screen-pixel);
        }

        /* Z ÌëúÏãú (ÏàòÎ©¥) */
        .zzz-display {
            position: absolute;
            top: 30px;
            right: 20px;
            font-size: 14px;
            color: var(--screen-pixel);
            font-family: monospace;
            display: none;
        }

        .zzz-display.active {
            display: block;
            animation: zzz-float 1.5s ease-in-out infinite;
        }

        @keyframes zzz-float {
            0%, 100% { opacity: 1; transform: translateY(0); }
            50% { opacity: 0.5; transform: translateY(-5px); }
        }

        /* Îò• ÌëúÏãú */
        .poop-display {
            position: absolute;
            bottom: 25px;
            font-size: 12px;
            color: var(--screen-pixel);
        }

        .poop-display.left { left: 15px; }
        .poop-display.right { right: 15px; }

        /* Ìé´ Ïù¥Î¶Ñ & Î†àÎ≤® */
        .pet-info {
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            text-align: center;
            font-size: 8px;
            color: var(--screen-pixel);
            font-family: 'DotGothic16', monospace;
        }

        /* Ïä§ÌÉØ Î∞î (ÌôîÎ©¥ ÌïòÎã®) */
        .stats-display {
            position: absolute;
            bottom: 25px;
            left: 8px;
            right: 8px;
            display: flex;
            justify-content: space-around;
        }

        .mini-stat {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 2px;
        }

        .mini-stat-icon {
            font-size: 8px;
        }

        .mini-stat-bar {
            width: 24px;
            height: 4px;
            background: rgba(0,0,0,0.2);
            border: 1px solid var(--screen-pixel);
        }

        .mini-stat-fill {
            height: 100%;
            background: var(--screen-pixel);
            transition: width 0.3s;
        }

        /* Î≤ÑÌäºÎì§ */
        .buttons {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 25px;
        }

        .btn {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            border: none;
            background: linear-gradient(145deg, #ffffff 0%, #e0e0e0 100%);
            box-shadow: 
                0 4px 0 #ccc,
                0 6px 10px rgba(0,0,0,0.2);
            cursor: pointer;
            transition: all 0.1s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .btn:active {
            transform: translateY(2px);
            box-shadow: 
                0 2px 0 #ccc,
                0 3px 5px rgba(0,0,0,0.2);
        }

        /* ÌïòÎã® Ïª®Ìä∏Î°§ */
        .bottom-controls {
            display: flex;
            gap: 15px;
            margin-top: 20px;
        }

        .control-btn {
            background: rgba(255,255,255,0.2);
            border: 2px solid rgba(255,255,255,0.5);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-family: inherit;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .control-btn:hover {
            background: rgba(255,255,255,0.3);
            border-color: white;
        }

        /* Î™®Îã¨ */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.8);
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            max-width: 320px;
            width: 90%;
        }

        .modal-content h2 {
            margin-bottom: 20px;
            color: #333;
        }

        .modal-content input {
            width: 100%;
            padding: 12px;
            border: 3px solid #ddd;
            border-radius: 10px;
            font-family: inherit;
            font-size: 16px;
            margin-bottom: 20px;
            text-align: center;
        }

        .modal-content input:focus {
            outline: none;
            border-color: #ff9a9e;
        }

        .modal-btn {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-family: inherit;
            font-size: 16px;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .modal-btn:hover {
            transform: scale(1.05);
        }

        /* Ï£ΩÏùå ÌôîÎ©¥ */
        .death-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--screen-bg);
            display: none;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
        }

        .death-overlay.active {
            display: flex;
        }

        .death-text {
            font-size: 10px;
            color: var(--screen-pixel);
            text-align: center;
            font-family: 'DotGothic16', monospace;
        }

        /* Î©îÏãúÏßÄ */
        .message-bubble {
            position: absolute;
            top: 35px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 8px;
            color: var(--screen-pixel);
            font-family: 'DotGothic16', monospace;
            text-align: center;
            max-width: 120px;
        }

        /* ÏÇ¨Ïù¥Îìú Í¥ëÍ≥† */
        .sidebar-ad {
            position: fixed;
            right: 20px;
            top: 50%;
            transform: translateY(-50%);
            width: 160px;
            height: 600px;
            background: rgba(255,255,255,0.1);
            border: 2px dashed rgba(255,255,255,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255,255,255,0.5);
            font-size: 11px;
            text-align: center;
            border-radius: 8px;
        }

        @media (max-width: 1200px) {
            .sidebar-ad { display: none; }
        }

        @media (max-width: 400px) {
            .device {
                width: 280px;
                height: 350px;
            }
            .screen-frame {
                width: 150px;
                height: 130px;
                top: 60px;
            }
            .buttons {
                bottom: 45px;
            }
            .pixel-pet {
                grid-template-columns: repeat(16, 5px);
                grid-template-rows: repeat(16, 5px);
            }
            .pixel { width: 5px; height: 5px; }
        }

        /* Ïï°ÏÖò Ìö®Í≥º */
        .action-effect {
            position: absolute;
            font-size: 16px;
            animation: effect-pop 0.6s ease-out forwards;
            pointer-events: none;
        }

        @keyframes effect-pop {
            0% { opacity: 1; transform: translateY(0) scale(1); }
            100% { opacity: 0; transform: translateY(-30px) scale(1.3); }
        }
    </style>
</head>
<body>
    <div class="ad-banner">AD SPACE (728x90)</div>

    <h1 class="game-title">TAMAGOTCHI</h1>

    <!-- Cover Selector -->
    <div class="cover-selector">
        <button class="cover-btn pink active" data-cover="pink" title="Pink"></button>
        <button class="cover-btn blue" data-cover="blue" title="Blue"></button>
        <button class="cover-btn purple" data-cover="purple" title="Purple"></button>
        <button class="cover-btn mint" data-cover="mint" title="Mint"></button>
        <button class="cover-btn orange" data-cover="orange" title="Orange"></button>
        <button class="cover-btn glitter" data-cover="glitter" title="Glitter"></button>
    </div>

    <!-- Device -->
    <div class="device">
        <div class="chain-loop"></div>
        <div class="device-body pink" id="deviceBody">
            <!-- ÌôîÎ©¥ -->
            <div class="screen-frame">
                <div class="screen" id="screen">
                    <!-- ÏÉÅÎã® ÏïÑÏù¥ÏΩò -->
                    <div class="screen-icons">
                        <div class="screen-icon" id="iconHungry">üç¥</div>
                        <div class="screen-icon" id="iconHappy">üí°</div>
                        <div class="screen-icon" id="iconPlay">‚öΩ</div>
                        <div class="screen-icon" id="iconMed">üíä</div>
                    </div>

                    <!-- Î©îÏãúÏßÄ -->
                    <div class="message-bubble" id="message"></div>

                    <!-- ÌîΩÏÖÄ Ï∫êÎ¶≠ÌÑ∞ -->
                    <div class="pixel-pet-container">
                        <div class="pixel-pet" id="pixelPet"></div>
                    </div>

                    <!-- Z ÌëúÏãú -->
                    <div class="zzz-display" id="zzzDisplay">Z z z</div>

                    <!-- Îò• -->
                    <div class="poop-display left" id="poop1" style="display:none;">‚óè~</div>
                    <div class="poop-display right" id="poop2" style="display:none;">‚óè~</div>

                    <!-- Ïä§ÌÉØ Î∞î -->
                    <div class="stats-display">
                        <div class="mini-stat">
                            <div class="mini-stat-bar"><div class="mini-stat-fill" id="barHunger" style="width:100%"></div></div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-bar"><div class="mini-stat-fill" id="barHappy" style="width:100%"></div></div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-bar"><div class="mini-stat-fill" id="barEnergy" style="width:100%"></div></div>
                        </div>
                        <div class="mini-stat">
                            <div class="mini-stat-bar"><div class="mini-stat-fill" id="barClean" style="width:100%"></div></div>
                        </div>
                    </div>

                    <!-- Ìé´ Ï†ïÎ≥¥ -->
                    <div class="pet-info" id="petInfo">Lv.1</div>

                    <!-- Ï£ΩÏùå ÌôîÎ©¥ -->
                    <div class="death-overlay" id="deathOverlay">
                        <div class="death-text">
                            üíÄ<br>
                            R.I.P<br>
                            <span id="deathName"></span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Î≤ÑÌäº -->
            <div class="buttons">
                <button class="btn" id="btnA" title="ÏÑ†ÌÉù">A</button>
                <button class="btn" id="btnB" title="Ïã§Ìñâ">B</button>
                <button class="btn" id="btnC" title="Ï∑®ÏÜå">C</button>
            </div>
        </div>
    </div>

    <!-- Bottom Controls -->
    <div class="bottom-controls">
        <button class="control-btn" id="btnFeed">üçñ Feed</button>
        <button class="control-btn" id="btnPlay">‚öΩ Play</button>
        <button class="control-btn" id="btnSleep">üò¥ Sleep</button>
        <button class="control-btn" id="btnClean">üßπ Clean</button>
        <button class="control-btn" id="btnReset">üîÑ Reset</button>
    </div>

    <!-- Sidebar Ad -->
    <div class="sidebar-ad">AD SPACE<br>(160x600)</div>

    <!-- Name Modal -->
    <div class="modal" id="nameModal">
        <div class="modal-content">
            <h2>ü•ö A new pet is born!</h2>
            <input type="text" id="nameInput" placeholder="Name your pet" maxlength="8">
            <button class="modal-btn" id="nameSubmit">Start!</button>
        </div>
    </div>

    <script>
        // Evolution stages based on level
        const evolutionStages = [
            { minLevel: 1, stage: 'baby', name: 'Baby' },
            { minLevel: 3, stage: 'child', name: 'Child' },
            { minLevel: 5, stage: 'teen', name: 'Teen' },
            { minLevel: 8, stage: 'adult', name: 'Adult' },
            { minLevel: 12, stage: 'special', name: 'Master' }
        ];

        // Pixel art patterns (16x16) for each evolution stage
        const petSprites = {
            // ===== BABY STAGE (Lv 1-2) =====
            baby_normal: [
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0000110110110000',
                '0000111111110000',
                '0000111001110000',
                '0000011111100000',
                '0000001111000000',
                '0000000110000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            baby_happy: [
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0000111011110000',
                '0000111111110000',
                '0000110000110000',
                '0000011111100000',
                '0000001111000000',
                '0000000110000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            baby_sad: [
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0000110110110000',
                '0000111111110000',
                '0000110110110000',
                '0000011111100000',
                '0000001111000000',
                '0000000110000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            baby_sleeping: [
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0000111111110000',
                '0000111111110000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            baby_eating: [
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0000110110110000',
                '0000111111110000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000000110000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],

            // ===== CHILD STAGE (Lv 3-4) =====
            child_normal: [
                '0000000000000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0001110110111000',
                '0001110110111000',
                '0001111111111000',
                '0001111001111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            child_happy: [
                '0000000000000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0001111011111000',
                '0001110000111000',
                '0001111111111000',
                '0001110000111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            child_sad: [
                '0000000000000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0001110110111000',
                '0001111111111000',
                '0001111111111000',
                '0001110110111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            child_sleeping: [
                '0000000000000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0001111111111000',
                '0001111011111000',
                '0001111111111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            child_eating: [
                '0000000000000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0001110110111000',
                '0001110110111000',
                '0001111111111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],

            // ===== TEEN STAGE (Lv 5-7) =====
            teen_normal: [
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011100110011100',
                '0011100110011100',
                '0011111111111100',
                '0011111111111100',
                '0001111001111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000'
            ],
            teen_happy: [
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011110110111100',
                '0011100000011100',
                '0011111111111100',
                '0011110000111100',
                '0001111111111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000'
            ],
            teen_sad: [
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011100110011100',
                '0011110110111100',
                '0011111111111100',
                '0011111111111100',
                '0001110000111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000'
            ],
            teen_sleeping: [
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011111111111100',
                '0011110110111100',
                '0011111111111100',
                '0011111111111100',
                '0001111111111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000000000000000',
                '0000000000000000'
            ],
            teen_eating: [
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011100110011100',
                '0011100110011100',
                '0011111111111100',
                '0011111001111100',
                '0001111111111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000001111000000',
                '0000011001100000',
                '0000000000000000'
            ],

            // ===== ADULT STAGE (Lv 8-11) =====
            adult_normal: [
                '0000011001100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011111111111100',
                '0111100110011110',
                '0111100110011110',
                '0111111111111110',
                '0011111111111100',
                '0011110000111100',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000111001110000',
                '0000110000110000',
                '0000000000000000'
            ],
            adult_happy: [
                '0000011001100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011111111111100',
                '0111110110111110',
                '0111100000011110',
                '0111111111111110',
                '0011111111111100',
                '0011100000011100',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000111001110000',
                '0000110000110000',
                '0000000000000000'
            ],
            adult_sad: [
                '0000011001100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011111111111100',
                '0111100110011110',
                '0111110110111110',
                '0111111111111110',
                '0011111111111100',
                '0011110110111100',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000111001110000',
                '0000110000110000',
                '0000000000000000'
            ],
            adult_sleeping: [
                '0000011001100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011111111111100',
                '0111111111111110',
                '0111110110111110',
                '0111111111111110',
                '0011111111111100',
                '0011111111111100',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            adult_eating: [
                '0000011001100000',
                '0000111111110000',
                '0001111111111000',
                '0011111111111100',
                '0011111111111100',
                '0111100110011110',
                '0111100110011110',
                '0111111111111110',
                '0011111111111100',
                '0011111111111100',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000111001110000',
                '0000110000110000',
                '0000000000000000'
            ],

            // ===== SPECIAL/MASTER STAGE (Lv 12+) =====
            special_normal: [
                '0000011111100000',
                '0001100000011000',
                '0011111111111100',
                '0111111111111110',
                '0111111111111110',
                '1111100110011111',
                '1111100110011111',
                '1111111111111111',
                '0111111111111110',
                '0111110000111110',
                '0011111111111100',
                '0001111111111000',
                '0000111111110000',
                '0001110001110000',
                '0001100000110000',
                '0000000000000000'
            ],
            special_happy: [
                '0000011111100000',
                '0001100000011000',
                '0011111111111100',
                '0111111111111110',
                '0111111111111110',
                '1111110110111111',
                '1111100000011111',
                '1111111111111111',
                '0111111111111110',
                '0111100000011110',
                '0011111111111100',
                '0001111111111000',
                '0000111111110000',
                '0001110001110000',
                '0001100000110000',
                '0000000000000000'
            ],
            special_sad: [
                '0000011111100000',
                '0001100000011000',
                '0011111111111100',
                '0111111111111110',
                '0111111111111110',
                '1111100110011111',
                '1111110110111111',
                '1111111111111111',
                '0111111111111110',
                '0111110110111110',
                '0011111111111100',
                '0001111111111000',
                '0000111111110000',
                '0001110001110000',
                '0001100000110000',
                '0000000000000000'
            ],
            special_sleeping: [
                '0000011111100000',
                '0001100000011000',
                '0011111111111100',
                '0111111111111110',
                '0111111111111110',
                '1111111111111111',
                '1111110110111111',
                '1111111111111111',
                '0111111111111110',
                '0111111111111110',
                '0011111111111100',
                '0001111111111000',
                '0000111111110000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ],
            special_eating: [
                '0000011111100000',
                '0001100000011000',
                '0011111111111100',
                '0111111111111110',
                '0111111111111110',
                '1111100110011111',
                '1111100110011111',
                '1111111111111111',
                '0111111111111110',
                '0111111111111110',
                '0011111111111100',
                '0001111111111000',
                '0000111111110000',
                '0001110001110000',
                '0001100000110000',
                '0000000000000000'
            ],

            // ===== COMMON SPRITES =====
            egg: [
                '0000000000000000',
                '0000000000000000',
                '0000001111000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0001110110111000',
                '0011111111111100',
                '0011111111111100',
                '0011111111111100',
                '0011111111111100',
                '0001111111111000',
                '0001111111111000',
                '0000111111110000',
                '0000011111100000',
                '0000000000000000'
            ],
            ghost: [
                '0000000000000000',
                '0000011111100000',
                '0000111111110000',
                '0001111111111000',
                '0001100110011000',
                '0001100110011000',
                '0001111111111000',
                '0001111111111000',
                '0001111001111000',
                '0001111111111000',
                '0001111111111000',
                '0001101101101000',
                '0001010101010000',
                '0000000000000000',
                '0000000000000000',
                '0000000000000000'
            ]
        };

        // Get current evolution stage
        function getEvolutionStage(level) {
            let current = evolutionStages[0];
            for (let stage of evolutionStages) {
                if (level >= stage.minLevel) {
                    current = stage;
                }
            }
            return current;
        }

        // Get sprite name based on stage and mood
        function getSpriteKey(stage, mood) {
            return `${stage}_${mood}`;
        }

        // Í≤åÏûÑ ÏÉÅÌÉú
        let game = {
            name: '',
            hunger: 100,
            happiness: 100,
            energy: 100,
            cleanliness: 100,
            level: 1,
            exp: 0,
            maxExp: 100,
            isSleeping: false,
            isDead: false,
            poopCount: 0,
            cover: 'pink',
            createdAt: null,
            lastUpdate: null
        };

        // DOM
        const $ = id => document.getElementById(id);
        const pixelPetEl = $('pixelPet');
        const deviceBody = $('deviceBody');
        const screen = $('screen');

        // ÌîΩÏÖÄ Ìé´ Î†åÎçîÎßÅ
        function renderPet(spriteName) {
            const sprite = petSprites[spriteName] || petSprites.normal;
            pixelPetEl.innerHTML = '';
            
            for (let row of sprite) {
                for (let col of row) {
                    const pixel = document.createElement('div');
                    pixel.className = col === '1' ? 'pixel on' : 'pixel';
                    pixelPetEl.appendChild(pixel);
                }
            }
        }

        // UI ÏóÖÎç∞Ïù¥Ìä∏
        function updateUI() {
            // Ïä§ÌÉØ Î∞î
            $('barHunger').style.width = game.hunger + '%';
            $('barHappy').style.width = game.happiness + '%';
            $('barEnergy').style.width = game.energy + '%';
            $('barClean').style.width = game.cleanliness + '%';

            // ÏïÑÏù¥ÏΩò ÌôúÏÑ±Ìôî (ÎÇÆÏùÄ Ïä§ÌÉØ ÌëúÏãú)
            $('iconHungry').classList.toggle('active', game.hunger < 40);
            $('iconHappy').classList.toggle('active', game.happiness < 40);
            $('iconPlay').classList.toggle('active', game.energy < 40);
            $('iconMed').classList.toggle('active', game.cleanliness < 40);

            // Îò•
            $('poop1').style.display = game.poopCount >= 1 ? 'block' : 'none';
            $('poop2').style.display = game.poopCount >= 2 ? 'block' : 'none';

            // Ìé´ Ï†ïÎ≥¥ (Î†àÎ≤® + ÏßÑÌôî Îã®Í≥Ñ)
            const stage = getEvolutionStage(game.level);
            $('petInfo').textContent = `Lv.${game.level} ${stage.name}`;

            // ZZZ
            $('zzzDisplay').classList.toggle('active', game.isSleeping);

            // Ìé´ ÏÉÅÌÉúÏóê Îî∞Î•∏ Ïä§ÌîÑÎùºÏù¥Ìä∏
            updatePetSprite();
        }

        function updatePetSprite() {
            if (game.isDead) {
                renderPet('ghost');
                $('deathOverlay').classList.add('active');
                $('deathName').textContent = game.name;
                return;
            }

            $('deathOverlay').classList.remove('active');
            pixelPetEl.className = 'pixel-pet';

            const stage = getEvolutionStage(game.level).stage;

            if (game.isSleeping) {
                renderPet(getSpriteKey(stage, 'sleeping'));
                pixelPetEl.classList.add('sleeping');
                return;
            }

            const avg = (game.hunger + game.happiness + game.energy + game.cleanliness) / 4;
            
            if (avg < 30) {
                renderPet(getSpriteKey(stage, 'sad'));
            } else if (avg > 70) {
                renderPet(getSpriteKey(stage, 'happy'));
            } else {
                renderPet(getSpriteKey(stage, 'normal'));
            }
        }

        // Î©îÏãúÏßÄ ÌëúÏãú
        function showMessage(text) {
            const msg = $('message');
            msg.textContent = text;
            setTimeout(() => msg.textContent = '', 2000);
        }

        // Ïù¥ÌéôÌä∏
        function showEffect(emoji) {
            const effect = document.createElement('div');
            effect.className = 'action-effect';
            effect.textContent = emoji;
            effect.style.left = Math.random() * 100 + 40 + 'px';
            effect.style.top = Math.random() * 50 + 40 + 'px';
            screen.appendChild(effect);
            setTimeout(() => effect.remove(), 600);
        }

        // Í≤ΩÌóòÏπò
        function addExp(amount) {
            const oldStage = getEvolutionStage(game.level);
            game.exp += amount;
            
            while (game.exp >= game.maxExp) {
                game.exp -= game.maxExp;
                game.level++;
                game.maxExp = Math.floor(game.maxExp * 1.5);
                
                const newStage = getEvolutionStage(game.level);
                
                // Check for evolution
                if (newStage.stage !== oldStage.stage) {
                    showMessage('EVOLVED! ‚Üí ' + newStage.name);
                    showEffect('üåü');
                    showEffect('‚ú®');
                    showEffect('üéâ');
                } else {
                    showMessage('LEVEL UP!');
                    showEffect('‚≠ê');
                }
            }
        }

        // Ïï°ÏÖòÎì§
        function feed() {
            if (game.isDead || game.isSleeping) return;
            game.hunger = Math.min(100, game.hunger + 30);
            game.cleanliness = Math.max(0, game.cleanliness - 5);
            addExp(10);
            
            const stage = getEvolutionStage(game.level).stage;
            renderPet(getSpriteKey(stage, 'eating'));
            pixelPetEl.classList.add('eating');
            showMessage('Yummy!');
            showEffect('üçñ');
            
            if (Math.random() < 0.3 && game.poopCount < 2) game.poopCount++;
            
            setTimeout(updatePetSprite, 1500);
            updateUI();
            saveGame();
        }

        function play() {
            if (game.isDead || game.isSleeping) return;
            if (game.energy < 20) {
                showMessage('Too tired...');
                return;
            }
            
            game.happiness = Math.min(100, game.happiness + 25);
            game.energy = Math.max(0, game.energy - 15);
            game.hunger = Math.max(0, game.hunger - 10);
            addExp(15);
            
            const stage = getEvolutionStage(game.level).stage;
            renderPet(getSpriteKey(stage, 'happy'));
            pixelPetEl.classList.add('playing');
            showMessage('So fun!');
            showEffect('‚öΩ');
            
            setTimeout(updatePetSprite, 2000);
            updateUI();
            saveGame();
        }

        function sleep() {
            if (game.isDead) return;
            
            game.isSleeping = !game.isSleeping;
            showMessage(game.isSleeping ? 'zzZ...' : 'Good morning!');
            updateUI();
            saveGame();
        }

        function clean() {
            if (game.isDead || game.isSleeping) return;
            
            game.cleanliness = Math.min(100, game.cleanliness + 40);
            game.poopCount = 0;
            addExp(5);
            
            showMessage('Sparkly!');
            showEffect('‚ú®');
            updateUI();
            saveGame();
        }

        // Í≤åÏûÑ Ìã±
        function gameTick() {
            if (game.isDead) return;
            
            if (game.isSleeping) {
                game.energy = Math.min(100, game.energy + 3);
                game.hunger = Math.max(0, game.hunger - 1);
            } else {
                game.hunger = Math.max(0, game.hunger - 2);
                game.happiness = Math.max(0, game.happiness - 1.5);
                game.energy = Math.max(0, game.energy - 1);
                game.cleanliness = Math.max(0, game.cleanliness - 1);
            }

            if (!game.isSleeping && Math.random() < 0.05 && game.poopCount < 2) {
                game.poopCount++;
                game.cleanliness = Math.max(0, game.cleanliness - 10);
            }

            if (game.hunger <= 0 || game.happiness <= 0) {
                game.isDead = true;
            }

            updateUI();
            saveGame();
        }

        // Ïª§Î≤Ñ Î≥ÄÍ≤Ω
        function changeCover(cover) {
            game.cover = cover;
            deviceBody.className = 'device-body ' + cover;
            document.querySelectorAll('.cover-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.cover === cover);
            });
            saveGame();
        }

        // Ï†ÄÏû•/Î∂àÎü¨Ïò§Í∏∞
        function saveGame() {
            game.lastUpdate = Date.now();
            localStorage.setItem('tamagochi_v2', JSON.stringify(game));
        }

        function loadGame() {
            const saved = localStorage.getItem('tamagochi_v2');
            if (saved) {
                const parsed = JSON.parse(saved);
                game = { ...game, ...parsed };
                
                // Ïò§ÌîÑÎùºÏù∏ ÏãúÍ∞Ñ
                if (game.lastUpdate) {
                    const offline = Math.min(Math.floor((Date.now() - game.lastUpdate) / 5000), 100);
                    for (let i = 0; i < offline; i++) {
                        if (!game.isDead) {
                            game.hunger = Math.max(0, game.hunger - 1);
                            game.happiness = Math.max(0, game.happiness - 0.5);
                        }
                    }
                    if (game.hunger <= 0 || game.happiness <= 0) game.isDead = true;
                }
                
                changeCover(game.cover || 'pink');
                return true;
            }
            return false;
        }

        function resetGame() {
            if (!confirm('Reset game?')) return;
            localStorage.removeItem('tamagochi_v2');
            game = {
                name: '', hunger: 100, happiness: 100, energy: 100, cleanliness: 100,
                level: 1, exp: 0, maxExp: 100, isSleeping: false, isDead: false,
                poopCount: 0, cover: 'pink', createdAt: null, lastUpdate: null
            };
            $('deathOverlay').classList.remove('active');
            $('nameModal').classList.add('active');
            changeCover('pink');
            updateUI();
        }

        // Ïù¥Î≤§Ìä∏
        $('btnFeed').onclick = feed;
        $('btnPlay').onclick = play;
        $('btnSleep').onclick = sleep;
        $('btnClean').onclick = clean;
        $('btnReset').onclick = resetGame;

        $('btnA').onclick = feed;
        $('btnB').onclick = play;
        $('btnC').onclick = sleep;

        document.querySelectorAll('.cover-btn').forEach(btn => {
            btn.onclick = () => changeCover(btn.dataset.cover);
        });

        $('nameSubmit').onclick = () => {
            const name = $('nameInput').value.trim();
            if (name) {
                game.name = name;
                game.createdAt = Date.now();
                $('nameModal').classList.remove('active');
                renderPet('egg');
                setTimeout(() => {
                    showMessage(name + ' is born!');
                    updatePetSprite();
                }, 1500);
                saveGame();
            }
        };

        $('nameInput').onkeypress = e => {
            if (e.key === 'Enter') $('nameSubmit').click();
        };

        // Ï¥àÍ∏∞Ìôî
        function init() {
            if (!loadGame() || !game.name) {
                $('nameModal').classList.add('active');
                renderPet('egg');
            } else {
                updateUI();
            }
            
            setInterval(gameTick, 5000);
        }

        init();
    </script>
</body>
</html>
